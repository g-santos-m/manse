<div class="container">

  <div *ngIf="!parte()" class="flex flex-col items-center justify-center py-20">
    <div class="text-xl font-semibold text-primary mb-2">Cargando parte...</div>
    <p class="text-text-secondary">Si tarda mucho, comprueba la consola (F12)</p>
  </div>

  <ng-container *ngIf="parte()">

    <div class="flex items-center justify-between mb-10">
      <h1 class="text-3xl font-bold text-primary">Detalle del Parte #{{ parte()!.id }}</h1>
      <button class="btn btn-outline" (click)="volver()">
        ← Volver al listado
      </button>
    </div>

    <div class="card">

      <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">

        <div class="space-y-6">

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Fecha de apertura</label>
            <p class="text-lg font-medium">{{ parte()!.fecha_apertura | date:'dd/MM/yyyy HH:mm' }}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Fecha de cierre</label>
            <p class="text-lg">
              <ng-container *ngIf="parte()!.fecha_cierre; else noCerrado">
                {{ parte()!.fecha_cierre | date:'dd/MM/yyyy HH:mm' }}
              </ng-container>
              <ng-template #noCerrado>
                <span class="text-text-secondary">— (Aún no cerrado)</span>
              </ng-template>
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Cliente</label>
            <p class="text-xl font-semibold text-primary">{{ parte()!.nombre_cliente }}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Dirección del edificio</label>
            <p class="text-lg">{{ parte()!.direccion_edificio }}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Ubicación concreta</label>
            <p class="text-lg">{{ parte()!.ubicacion_concreta || '—' }}</p>
          </div>

        </div>

        <div class="space-y-6">

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Contacto incidencia</label>
            <p class="text-lg">{{ parte()!.contacto_incidencia || '—' }}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Urgente</label>
            <span class="badge" [class.badge-danger]="parte()!.urgente" [class.badge-success]="!parte()!.urgente">
              {{ parte()!.urgente ? 'SÍ - URGENTE' : 'No' }}
            </span>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Técnico asignado</label>

            <p class="text-lg font-medium">
              {{ getNombreTecnico(parte()!.tecnico) }}
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Descripción breve</label>
            <p class="text-lg font-medium text-primary">{{ parte()!.descripcion_breve }}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-1">Detalle completo</label>
            <div class="bg-surface/50 border rounded-lg p-4 text-lg whitespace-pre-line">
              {{ parte()!.descripcion_detalle || 'Sin descripción detallada' }}
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-text-secondary mb-2">Estado actual</label>
            <span class="badge badge-lg" [class.badge-success]="parte()!.estado === 'Cerrado'"
              [class.badge-warning]="parte()!.estado === 'Abierto'">
              {{ parte()!.estado }}
            </span>
          </div>

        </div>
      </div>

      <div class="flex justify-end gap-4 mt-10 pt-8 border-t border-slate-200">
        <button class="btn btn-outline" (click)="volver()">Cancelar</button>
        <button class="btn btn-primary" (click)="editar()">Editar parte</button>
      </div>

    </div>
  </ng-container>
</div>