<div class="container">

    <div class="flex items-center justify-between mb-10">
        <h1 class="text-3xl font-bold text-primary">{{ title() }}</h1>
    </div>

    <div class="card">

        <form (ngSubmit)="onSubmit()" #form="ngForm">

            <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">

                <div class="space-y-6">
                    <div>
                        <label for="fecha_apertura" class="block text-sm font-medium text-text-secondary mb-1">
                            Fecha de apertura <span class="text-danger">*</span>
                        </label>
                        <input type="datetime-local" id="fecha_apertura" name="fecha_apertura"
                            [(ngModel)]="incidencia().fecha_apertura" required
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition">
                    </div>

                    <div>
                        <label for="fecha_cierre" class="block text-sm font-medium text-text-secondary mb-1">
                            Fecha de cierre
                        </label>
                        <input type="datetime-local" id="fecha_cierre" name="fecha_cierre"
                            [(ngModel)]="incidencia().fecha_cierre"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition">
                        <p class="text-xs text-text-secondary mt-1">Dejar vacío si aún está abierto</p>
                    </div>

                    <div>
                        <label for="nombre_cliente" class="block text-sm font-medium text-text-secondary mb-1">
                            Cliente / Comunidad <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="nombre_cliente" name="nombre_cliente"
                            [(ngModel)]="incidencia().nombre_cliente" required placeholder="Ej: Comunidad Sol y Mar"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>

                    <div>
                        <label for="direccion_edificio" class="block text-sm font-medium text-text-secondary mb-1">
                            Dirección del edificio <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="direccion_edificio" name="direccion_edificio"
                            [(ngModel)]="incidencia().direccion_edificio" required placeholder="Calle, número..."
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>

                    <div>
                        <label for="ubicacion_concreta" class="block text-sm font-medium text-text-secondary mb-1">
                            Ubicación concreta <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="ubicacion_concreta" name="ubicacion_concreta"
                            [(ngModel)]="incidencia().ubicacion_concreta" required placeholder="Portal 2, 3ª planta..."
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>
                </div>

                <div class="space-y-6">
                    <div>
                        <label for="contacto_incidencia" class="block text-sm font-medium text-text-secondary mb-1">
                            Contacto incidencia <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="contacto_incidencia" name="contacto_incidencia"
                            [(ngModel)]="incidencia().contacto_incidencia" required
                            placeholder="Nombre persona contacto"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>

                    <div class="flex items-center gap-4 py-2">
                        <input type="checkbox" id="urgente" name="urgente" [(ngModel)]="incidencia().urgente"
                            class="w-5 h-5 text-danger rounded focus:ring-danger border-slate-300">
                        <label for="urgente" class="text-lg font-medium cursor-pointer select-none text-text-primary">
                            Incidencia URGENTE
                        </label>
                        <span class="badge badge-danger" *ngIf="incidencia().urgente">Prioridad alta</span>
                    </div>

                    <div>
                        <label for="tecnico" class="block text-sm font-medium text-text-secondary mb-1">
                            Técnico asignado <span class="text-danger">*</span>
                        </label>

                        <select id="tecnico" name="tecnico" [(ngModel)]="incidencia().tecnico" required
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary bg-transparent">
                            <option value="" disabled>-- Seleccione técnico --</option>
                            <option *ngFor="let tech of listaTecnicos" [value]="tech.id">
                                {{ tech.nombre }}
                            </option>
                        </select>
                    </div>

                    <div>
                        <label for="descripcion_breve" class="block text-sm font-medium text-text-secondary mb-1">
                            Descripción breve <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="descripcion_breve" name="descripcion_breve"
                            [(ngModel)]="incidencia().descripcion_breve" required
                            placeholder="Ej: Puerta garaje atascada"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>

                    <div>
                        <label for="descripcion_detalle" class="block text-sm font-medium text-text-secondary mb-1">
                            Detalle completo <span class="text-danger">*</span>
                        </label>
                        <textarea id="descripcion_detalle" name="descripcion_detalle" rows="5"
                            [(ngModel)]="incidencia().descripcion_detalle" required
                            placeholder="Describe con detalle qué pasa..."
                            class="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary resize-vertical"></textarea>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-4 mt-10 pt-8 border-t border-slate-200">
                <button type="button" class="btn btn-outline" (click)="cancelarAccion()">
                    Cancelar
                </button>

                <button *ngIf="esEdicionMode()" type="button" class="btn btn-danger" (click)="borrarParte()">
                    Borrar
                </button>

                <button type="submit" class="btn btn-primary">
                    <span *ngIf="esEdicionMode()">Actualizar Parte</span>
                    <span *ngIf="!esEdicionMode()">Crear Nuevo Parte</span>
                </button>
            </div>

        </form>
    </div>
</div>