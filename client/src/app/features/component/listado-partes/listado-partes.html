<!-- listado-partes.html -->
<div class="listado-partes">
  <h2>Listado de Partes de Trabajo</h2>

  <!-- FILTROS -->
  <div class="filtros">
    <input
      type="text"
      placeholder="Buscar por cliente, dirección, nº parte..."
      [(ngModel)]="filtroTexto"
      (input)="aplicarFiltros()"
      class="filtro-busqueda"
    />

    <select [(ngModel)]="filtroUrgente" (change)="aplicarFiltros()">
      <option [ngValue]="null">Todos</option>
      <option [ngValue]="true">Urgentes</option>
      <option [ngValue]="false">No urgentes</option>
    </select>

    <select [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
      <option [ngValue]="null">Todos</option>
      <option value="Abierto">Abierto</option>
      <option value="Cerrado">Cerrado</option>
    </select>

    <button
      class="btn-limpiar"
      (click)="limpiarFiltros()"
      *ngIf="filtroTexto || filtroUrgente !== null || filtroEstado">
      Limpiar filtros
    </button>
  </div>

  <!-- TABLA -->
  <div class="tabla-container">
    <table class="tabla-partes">
      <thead>
        <tr>
          <th># Parte</th>
          <th>Fecha apertura</th>
          <th>Cliente</th>
          <th>Dirección</th>
          <th>Ubicación</th>
          <th class="centro">Urgente</th>
          <th>Técnico</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let parte of partesFiltrados"
          class="fila-clickeable"
          [class.fila-urgente]="parte.urgente"
          (click)="verDetalle(parte.id)"
          >
          <td><strong>#{{ parte.id }}</strong></td>
          <td>{{ parte.fecha_apertura | date:'dd/MM/yyyy' }}</td>
          <td class="cliente">{{ parte.nombre_cliente }}</td>
          <td>{{ parte.direccion_edificio }}</td>
          <td>{{ parte.ubicacion_concreta }}</td>

          <td class="centro">
            <span class="badge" [class.urgente]="parte.urgente">
              {{ parte.urgente ? 'SÍ' : 'No' }}
            </span>
          </td>

          <td>{{ parte.tecnico || '—' }}</td>

          <td>
            <span
              class="estado"
              [ngClass]="{
                'estado-abierto':  parte.estado === 'Abierto',
                'estado-cerrado':  parte.estado === 'Cerrado'
              }"
            >
              {{ parte.estado }}
            </span>
          </td>

          <td class="acciones" (click)="$event.stopPropagation()">
            <!-- Este botón sigue teniendo routerLink (funciona perfecto) -->
            <button
              class="btn-ver"
              [routerLink]="['/partes', parte.id]">
              Ver detalle
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- SIN RESULTADOS -->
    <div *ngIf="partesFiltrados.length === 0" class="sin-resultados">
      <p>No se encontraron partes con los filtros actuales.</p>
      <button class="btn-limpiar" (click)="limpiarFiltros()">Quitar filtros</button>
    </div>
  </div>
</div>
